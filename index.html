<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ada's Pixel Art Editor</title>
    <style>
        :root {
            --bg: #1a1a1a;
            --ui: #2d2d2d;
            --text: #e0e0e0;
            --accent: #4a9eff;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }

        header {
            padding: 1rem;
            width: 100%;
            text-align: center;
            background: var(--ui);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        main {
            display: flex;
            flex: 1;
            width: 100%;
            gap: 1rem;
            padding: 1rem;
            box-sizing: border-box;
            justify-content: center;
        }

        #toolbar {
            background: var(--ui);
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 80px;
        }

        .tool {
            width: 50px;
            height: 50px;
            background: #3d3d3d;
            border: 2px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
        }

        .tool.active {
            border-color: var(--accent);
            background: #444;
        }

        #canvas-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #111;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            background-image: 
                linear-gradient(45deg, #222 25%, transparent 25%),
                linear-gradient(-45deg, #222 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #222 75%),
                linear-gradient(-45deg, transparent 75%, #222 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            touch-action: none;
        }

        canvas {
            image-rendering: pixelated;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            background: white;
            cursor: crosshair;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        @media (max-width: 768px) {
            main {
                flex-direction: column;
                overflow-y: auto;
            }
            #toolbar {
                width: 100%;
                flex-direction: row;
                height: auto;
                justify-content: center;
                box-sizing: border-box;
            }
            #sidebar {
                width: 100%;
                box-sizing: border-box;
            }
            #canvas-container {
                min-height: 350px;
            }
        }
    </style>
</head>
<body>
    <header>
        Ada's Pixel Editor
    </header>
    <main>
        <div id="toolbar">
            <div class="tool active" id="btn-pencil" title="é“…ç¬” (P)">âœï¸</div>
            <div class="tool" id="btn-eraser" title="æ©¡çš® (E)">ğŸ§¼</div>
            <div class="tool" id="btn-bucket" title="æ²¹æ¼†æ¡¶ (B)">ğŸª£</div>
            <input type="color" id="color-picker" style="width: 50px; height: 50px; padding:0; border:none; cursor:pointer; background:none;">
        </div>
        
        <div id="canvas-container">
            <canvas id="pixel-canvas"></canvas>
        </div>

        <div id="sidebar">
            <div class="section">
                <div>è°ƒè‰²ç›˜</div>
                <div class="color-palette" id="palette"></div>
            </div>
            <hr style="width:100%; opacity:0.1;">
            <button id="btn-download">ä¸‹è½½ PNG</button>
            <button id="btn-clear" style="background:#ff4a4a;">æ¸…ç©º</button>
            <div id="status">ç”»å¸ƒå¤§å°: 32x32</div>
        </div>
    </main>

    <script>
        const canvas = document.getElementById('pixel-canvas');
        const ctx = canvas.getContext('2d');
        const paletteContainer = document.getElementById('palette');
        const colorPicker = document.getElementById('color-picker');
        
        const GRID_SIZE = 32;
        const SCALE = 20;
        
        canvas.width = GRID_SIZE * SCALE;
        canvas.height = GRID_SIZE * SCALE;

        let isDrawing = false;
        let currentColor = '#000000';
        let currentTool = 'pencil';
        
        const colors = [
            '#000000', '#ffffff', '#ff0000', '#00ff00', '#0000ff', 
            '#ffff00', '#ff00ff', '#00ffff', '#888888', '#444444',
            '#aa0000', '#00aa00', '#0000aa', '#aaaa00', '#aa00aa', '#00aaaa'
        ];

        // åˆå§‹åŒ–
        function init() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            colors.forEach(color => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = color;
                swatch.onclick = () => selectColor(color, swatch);
                paletteContainer.appendChild(swatch);
                if (color === currentColor) swatch.classList.add('active');
            });
            
            colorPicker.value = currentColor;
            colorPicker.oninput = (e) => selectColor(e.target.value);
        }

        function selectColor(color, swatch) {
            currentColor = color;
            colorPicker.value = color;
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
            if (swatch) swatch.classList.add('active');
        }

        function getEventPos(e) {
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;
            
            if (e.touches) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            const x = Math.floor((clientX - rect.left) / (rect.width / GRID_SIZE));
            const y = Math.floor((clientY - rect.top) / (rect.height / GRID_SIZE));
            return { x, y };
        }

        function draw(e) {
            if (!isDrawing) return;
            if (e.cancelable) e.preventDefault();
            
            const { x, y } = getEventPos(e);
            
            if (currentTool === 'pencil') {
                ctx.fillStyle = currentColor;
                ctx.fillRect(x * SCALE, y * SCALE, SCALE, SCALE);
            } else if (currentTool === 'eraser') {
                ctx.fillStyle = 'white';
                ctx.fillRect(x * SCALE, y * SCALE, SCALE, SCALE);
            }
        }

        const handleStart = (e) => {
            isDrawing = true;
            if (currentTool === 'bucket') {
                floodFill(e);
            } else {
                draw(e);
            }
        };

        const handleEnd = () => isDrawing = false;

        // é¼ æ ‡äº‹ä»¶
        canvas.onmousedown = handleStart;
        window.addEventListener('mouseup', handleEnd);
        canvas.onmousemove = draw;

        // è§¦æ‘¸äº‹ä»¶
        canvas.addEventListener('touchstart', handleStart, {passive: false});
        canvas.addEventListener('touchend', handleEnd);
        canvas.addEventListener('touchmove', draw, {passive: false});

        // ç®€å•çš„æ²¹æ¼†æ¡¶ç®—æ³• (æ‰«æçº¿å¡«å……è¾ƒå¤æ‚ï¼Œè¿™é‡Œç”¨åŸºç¡€é€’å½’æˆ–æ¨¡æ‹Ÿ)
        function floodFill(e) {
            const { x, y } = getMousePos(e);
            const targetColor = getPixelColor(x, y);
            if (targetColor === currentColor) return;
            
            const fill = (x, y) => {
                if (x < 0 || x >= GRID_SIZE || y < 0 || y >= GRID_SIZE) return;
                if (getPixelColor(x, y) !== targetColor) return;
                
                ctx.fillStyle = currentColor;
                ctx.fillRect(x * SCALE, y * SCALE, SCALE, SCALE);
                
                fill(x + 1, y);
                fill(x - 1, y);
                fill(x, y + 1);
                fill(x, y - 1);
            };
            // ä¸ºäº†é˜²æ­¢æ ˆæº¢å‡ºï¼Œå°å‹ç”»å¸ƒå¯ç”¨é€’å½’ï¼Œå¤§ç”»å¸ƒéœ€ç”¨é˜Ÿåˆ—
            fill(x, y);
        }

        function getPixelColor(x, y) {
            const data = ctx.getImageData(x * SCALE + 1, y * SCALE + 1, 1, 1).data;
            return `#${((1 << 24) + (data[0] << 16) + (data[1] << 8) + data[2]).toString(16).slice(1)}`;
        }

        // å·¥å…·åˆ‡æ¢
        document.getElementById('btn-pencil').onclick = () => setTool('pencil');
        document.getElementById('btn-eraser').onclick = () => setTool('eraser');
        document.getElementById('btn-bucket').onclick = () => setTool('bucket');

        function setTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.tool').forEach(t => t.classList.remove('active'));
            document.getElementById(`btn-${tool}`).classList.add('active');
        }

        // ä¸‹è½½
        document.getElementById('btn-download').onclick = () => {
            // åˆ›å»ºä¸€ä¸ªå°å°ºå¯¸çš„ä¸´æ—¶ç”»å¸ƒæ¥ä¿å­˜åŸå§‹åƒç´ 
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = GRID_SIZE;
            tempCanvas.height = GRID_SIZE;
            const tempCtx = tempCanvas.getContext('2d');
            
            // å°†å¤§ç”»å¸ƒå†…å®¹ç¼©å°å› 32x32
            for(let y=0; y<GRID_SIZE; y++) {
                for(let x=0; x<GRID_SIZE; x++) {
                    const color = getPixelColor(x, y);
                    tempCtx.fillStyle = color;
                    tempCtx.fillRect(x, y, 1, 1);
                }
            }
            
            const link = document.createElement('a');
            link.download = 'pixel-art.png';
            link.href = tempCanvas.toDataURL();
            link.click();
        };

        document.getElementById('btn-clear').onclick = () => {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå—ï¼Ÿ')) {
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
        };

        // å¿«æ·é”®
        window.onkeydown = (e) => {
            if (e.key === 'p') setTool('pencil');
            if (e.key === 'e') setTool('eraser');
            if (e.key === 'b') setTool('bucket');
        };

        init();
    </script>
</body>
</html>